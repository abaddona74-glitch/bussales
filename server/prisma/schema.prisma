// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum Role {
  USER
  ADMIN
  DRIVER
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
}

enum TripStatus {
  SCHEDULED
  ON_WAY
  COMPLETED
  CANCELLED
}

model User {
  id        Int       @id @default(autoincrement())
  email     String    @unique
  password  String
  name      String?
  role      Role      @default(USER)
  bookings  Booking[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
}

model City {
  id        Int      @id @default(autoincrement())
  name      String   @unique
  routesFrom Route[] @relation("RouteFrom")
  routesTo   Route[] @relation("RouteTo")
}

model Bus {
  id        Int      @id @default(autoincrement())
  number    String   @unique // Davlat raqami
  model     String
  seats     Int
  trips     Trip[]
}

model Route {
  id          Int      @id @default(autoincrement())
  fromCityId  Int
  toCityId    Int
  distance    Float
  duration    Int      // Minutes
  price       Float    // Base price
  fromCity    City     @relation("RouteFrom", fields: [fromCityId], references: [id])
  toCity      City     @relation("RouteTo", fields: [toCityId], references: [id])
  trips       Trip[]

  @@unique([fromCityId, toCityId])
}

model Trip {
  id             Int        @id @default(autoincrement())
  routeId        Int
  busId          Int
  departureTime  DateTime
  arrivalTime    DateTime
  price          Float
  status         TripStatus @default(SCHEDULED)
  route          Route      @relation(fields: [routeId], references: [id])
  bus            Bus        @relation(fields: [busId], references: [id])
  bookings       Booking[]
}

model Booking {
  id          Int           @id @default(autoincrement())
  userId      Int
  tripId      Int
  seatNumber  Int
  status      BookingStatus @default(PENDING)
  totalPrice  Float
  createdAt   DateTime      @default(now())
  user        User          @relation(fields: [userId], references: [id])
  trip        Trip          @relation(fields: [tripId], references: [id])

  @@unique([tripId, seatNumber]) // Bir joyga 2 ta bilet sotilmasligi uchun
}
